- name: Clean Up
  hosts: storage_arrays
  gather_facts: false
  delegate_to: localhost

  vars:
    connection_info:
      address: "{{ ip }}"
      username: "{{ username }}"
      password: "{{ password }}"

  tasks:
    - name: Get ldev with same name
      hitachivantara.vspone_block.vsp.hv_ldev_facts:
        connection_info: "{{ connection_info }}"
        spec:
          name: "William"
      register: result

    - name: Debug the result variable
      ansible.builtin.debug:
        var: result

    - name: Force delete ldev
      hitachivantara.vspone_block.vsp.hv_ldev:
        connection_info: "{{ connection_info }}"
        state: "absent"
        spec:
          ldev_id: "{{ item.ldev_id }}"
          force: true
      loop: "{{ result.ansible_facts.volumes }}"
